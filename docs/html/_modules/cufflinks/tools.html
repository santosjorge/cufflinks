
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>cufflinks.tools &#8212; Cufflinks  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cufflinks.tools</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.offline</span> <span class="k">as</span> <span class="nn">py_offline</span>
<span class="kn">import</span> <span class="nn">plotly.plotly</span> <span class="k">as</span> <span class="nn">py</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">auth</span><span class="p">,</span> <span class="n">ta</span>
<span class="kn">from</span> <span class="nn">.colors</span> <span class="k">import</span> <span class="n">normalize</span><span class="p">,</span> <span class="n">to_rgba</span>
<span class="kn">from</span> <span class="nn">.themes</span> <span class="k">import</span> <span class="n">THEMES</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="p">(</span><span class="n">check_kwargs</span><span class="p">,</span> <span class="n">deep_update</span><span class="p">,</span> <span class="n">dict_replace_keyword</span><span class="p">,</span>
                    <span class="n">kwargs_from_keyword</span><span class="p">,</span> <span class="n">merge_dict</span><span class="p">)</span>

<span class="n">__LAYOUT_VALID_KWARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span><span class="s1">&#39;logx&#39;</span><span class="p">,</span><span class="s1">&#39;logy&#39;</span><span class="p">,</span><span class="s1">&#39;logz&#39;</span><span class="p">,</span><span class="s1">&#39;layout_update&#39;</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
					<span class="s1">&#39;xrange&#39;</span><span class="p">,</span><span class="s1">&#39;yrange&#39;</span><span class="p">,</span><span class="s1">&#39;zrange&#39;</span><span class="p">,</span><span class="s1">&#39;rangeselector&#39;</span><span class="p">,</span><span class="s1">&#39;rangeslider&#39;</span><span class="p">,</span><span class="s1">&#39;showlegend&#39;</span><span class="p">,</span><span class="s1">&#39;fontfamily&#39;</span><span class="p">]</span>

<span class="n">__SHAPES_KWARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vline&#39;</span><span class="p">,</span><span class="s1">&#39;hline&#39;</span><span class="p">,</span><span class="s1">&#39;shapes&#39;</span><span class="p">,</span><span class="s1">&#39;hspan&#39;</span><span class="p">,</span><span class="s1">&#39;vspan&#39;</span><span class="p">]</span>

<span class="n">__GEO_KWARGS</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">,</span><span class="s1">&#39;showframe&#39;</span><span class="p">,</span><span class="s1">&#39;showlakes&#39;</span><span class="p">,</span><span class="s1">&#39;coastlinecolor&#39;</span><span class="p">,</span><span class="s1">&#39;countrywidth&#39;</span><span class="p">,</span><span class="s1">&#39;countrycolor&#39;</span><span class="p">,</span>
			 <span class="s1">&#39;showsubunits&#39;</span><span class="p">,</span><span class="s1">&#39;bgcolor&#39;</span><span class="p">,</span><span class="s1">&#39;showrivers&#39;</span><span class="p">,</span><span class="s1">&#39;subunitcolor&#39;</span><span class="p">,</span><span class="s1">&#39;showcountries&#39;</span><span class="p">,</span><span class="s1">&#39;riverwidth&#39;</span><span class="p">,</span><span class="s1">&#39;scope&#39;</span><span class="p">,</span>
			 <span class="s1">&#39;rivercolor&#39;</span><span class="p">,</span><span class="s1">&#39;lataxis&#39;</span><span class="p">,</span><span class="s1">&#39;subunitwidth&#39;</span><span class="p">,</span><span class="s1">&#39;showocean&#39;</span><span class="p">,</span><span class="s1">&#39;oceancolor&#39;</span><span class="p">,</span><span class="s1">&#39;lakecolor&#39;</span><span class="p">,</span><span class="s1">&#39;showland&#39;</span><span class="p">,</span><span class="s1">&#39;lonaxis&#39;</span><span class="p">,</span>
			 <span class="s1">&#39;framecolor&#39;</span><span class="p">,</span><span class="s1">&#39;coastlinewidth&#39;</span><span class="p">,</span><span class="s1">&#39;landcolor&#39;</span><span class="p">,</span><span class="s1">&#39;showcoastlines&#39;</span><span class="p">,</span><span class="s1">&#39;framewidth&#39;</span><span class="p">,</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span><span class="s1">&#39;projection_type&#39;</span><span class="p">]</span>

<span class="n">__ANN_KWARGS</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;xref&#39;</span><span class="p">,</span><span class="s1">&#39;yref&#39;</span><span class="p">,</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;showarrow&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;arrowhead&#39;</span><span class="p">,</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="s1">&#39;textangle&#39;</span><span class="p">,</span><span class="s1">&#39;arrowsize&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;arrowwidth&#39;</span><span class="p">,</span><span class="s1">&#39;arrowcolor&#39;</span><span class="p">,</span><span class="s1">&#39;fontcolor&#39;</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">,</span><span class="s1">&#39;xanchor&#39;</span><span class="p">,</span><span class="s1">&#39;yanchor&#39;</span><span class="p">,</span><span class="s1">&#39;align&#39;</span><span class="p">]</span>

<span class="n">__LAYOUT_AXIS</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;autorange&#39;</span><span class="p">,</span><span class="s1">&#39;autotick&#39;</span><span class="p">,</span><span class="s1">&#39;backgroundcolor&#39;</span><span class="p">,</span><span class="s1">&#39;categoryarray&#39;</span><span class="p">,</span><span class="s1">&#39;categoryarraysrc&#39;</span><span class="p">,</span><span class="s1">&#39;categoryorder&#39;</span><span class="p">,</span>
			   <span class="s1">&#39;dtick&#39;</span><span class="p">,</span><span class="s1">&#39;exponentformat&#39;</span><span class="p">,</span><span class="s1">&#39;fixedrange&#39;</span><span class="p">,</span><span class="s1">&#39;gridcolor&#39;</span><span class="p">,</span><span class="s1">&#39;gridwidth&#39;</span><span class="p">,</span><span class="s1">&#39;hoverformat&#39;</span><span class="p">,</span><span class="s1">&#39;linecolor&#39;</span><span class="p">,</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span>
			   <span class="s1">&#39;mirror&#39;</span><span class="p">,</span><span class="s1">&#39;nticks&#39;</span><span class="p">,</span><span class="s1">&#39;showaxeslabels&#39;</span><span class="p">,</span><span class="s1">&#39;showbackground&#39;</span><span class="p">,</span><span class="s1">&#39;showexponent&#39;</span><span class="p">,</span><span class="s1">&#39;showgrid&#39;</span><span class="p">,</span><span class="s1">&#39;showline&#39;</span><span class="p">,</span><span class="s1">&#39;showspikes&#39;</span><span class="p">,</span>
			   <span class="s1">&#39;showticklabels&#39;</span><span class="p">,</span><span class="s1">&#39;showtickprefix&#39;</span><span class="p">,</span><span class="s1">&#39;showticksuffix&#39;</span><span class="p">,</span><span class="s1">&#39;spikecolor&#39;</span><span class="p">,</span><span class="s1">&#39;spikesides&#39;</span><span class="p">,</span><span class="s1">&#39;spikethickness&#39;</span><span class="p">,</span>
			   <span class="s1">&#39;tick0&#39;</span><span class="p">,</span><span class="s1">&#39;tickangle&#39;</span><span class="p">,</span><span class="s1">&#39;tickcolor&#39;</span><span class="p">,</span><span class="s1">&#39;tickfont&#39;</span><span class="p">,</span><span class="s1">&#39;tickformat&#39;</span><span class="p">,</span><span class="s1">&#39;ticklen&#39;</span><span class="p">,</span><span class="s1">&#39;tickmode&#39;</span><span class="p">,</span><span class="s1">&#39;tickprefix&#39;</span><span class="p">,</span><span class="s1">&#39;ticks&#39;</span><span class="p">,</span>
			   <span class="s1">&#39;ticksuffix&#39;</span><span class="p">,</span><span class="s1">&#39;ticktext&#39;</span><span class="p">,</span><span class="s1">&#39;ticktextsrc&#39;</span><span class="p">,</span><span class="s1">&#39;tickvals&#39;</span><span class="p">,</span><span class="s1">&#39;tickvalssrc&#39;</span><span class="p">,</span><span class="s1">&#39;tickwidth&#39;</span><span class="p">,</span><span class="s1">&#39;titlefont&#39;</span><span class="p">,</span>
			   <span class="s1">&#39;zeroline&#39;</span><span class="p">,</span><span class="s1">&#39;zerolinecolor&#39;</span><span class="p">,</span><span class="s1">&#39;zerolinewidth&#39;</span><span class="p">]</span>

<span class="n">__LAYOUT_AXIS_X</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;xaxis_&#39;</span><span class="o">+</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">go</span><span class="o">.</span><span class="n">XAxis</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()]</span>
<span class="n">__LAYOUT_AXIS_Y</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;yaxis_&#39;</span><span class="o">+</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">go</span><span class="o">.</span><span class="n">YAxis</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()]</span>

<span class="n">__LAYOUT_KWARGS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">[</span><span class="n">__LAYOUT_KWARGS</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">[</span><span class="n">__LAYOUT_VALID_KWARGS</span><span class="p">,</span><span class="n">__SHAPES_KWARGS</span><span class="p">,</span><span class="n">__GEO_KWARGS</span><span class="p">,</span><span class="n">__ANN_KWARGS</span><span class="p">,</span><span class="n">__LAYOUT_AXIS</span><span class="p">,</span>
									 <span class="n">__LAYOUT_AXIS_X</span><span class="p">,</span><span class="n">__LAYOUT_AXIS_Y</span><span class="p">]]</span>

<div class="viewcode-block" id="getTheme"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.getTheme">[docs]</a><span class="k">def</span> <span class="nf">getTheme</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Returns a theme definition.</span>

<span class="sd">	To see the colors translated (hex) use</span>
<span class="sd">	cufflinks.getLayout(theme) instead.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">theme</span><span class="p">:</span>
		<span class="n">theme</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">get_config_file</span><span class="p">()[</span><span class="s1">&#39;theme&#39;</span><span class="p">]</span>

	<span class="k">if</span> <span class="n">theme</span> <span class="ow">in</span> <span class="n">THEMES</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">THEMES</span><span class="p">[</span><span class="n">theme</span><span class="p">])</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Theme: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theme</span><span class="p">))</span></div>

<div class="viewcode-block" id="getThemes"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.getThemes">[docs]</a><span class="k">def</span> <span class="nf">getThemes</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Returns the list of available themes</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">THEMES</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="getLayout"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.getLayout">[docs]</a><span class="k">def</span> <span class="nf">getLayout</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">theme</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">xTitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">yTitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">zTitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">bargap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">bargroupgap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
			  <span class="n">margin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
			  <span class="n">annotations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">is3d</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generates a plotly Layout</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		theme : string</span>
<span class="sd">			Layout Theme</span>
<span class="sd">				solar</span>
<span class="sd">				pearl</span>
<span class="sd">				white</span>
<span class="sd">		title : string</span>
<span class="sd">			Chart Title</span>
<span class="sd">		xTitle : string</span>
<span class="sd">			X Axis Title</span>
<span class="sd">		yTitle : string</span>
<span class="sd">			Y Axis Title</span>
<span class="sd">		zTitle : string</span>
<span class="sd">			Z Axis Title</span>
<span class="sd">			Applicable only for 3d charts</span>
<span class="sd">		barmode : string</span>
<span class="sd">			Mode when displaying bars</span>
<span class="sd">				group</span>
<span class="sd">				stack</span>
<span class="sd">				overlay</span>
<span class="sd">		bargap : float</span>
<span class="sd">			Sets the gap between bars</span>
<span class="sd">				[0,1)</span>
<span class="sd">			Applicabe for bar and histogram plots</span>
<span class="sd">		bargroupgap : float</span>
<span class="sd">			Set the gap between groups</span>
<span class="sd">				[0,1)</span>
<span class="sd">			Applicabe for bar and histogram plots</span>
<span class="sd">		gridcolor : string</span>
<span class="sd">				grid color</span>
<span class="sd">		zerolinecolor : string</span>
<span class="sd">				zero line color</span>
<span class="sd">		margin : dict or tuple</span>
<span class="sd">				Dictionary (l,r,b,t) or</span>
<span class="sd">				Tuple containing the left,</span>
<span class="sd">				right, bottom and top margins</span>
<span class="sd">		dimensions : tuple</span>
<span class="sd">			Dimensions of figure</span>
<span class="sd">		annotations : dict or list</span>
<span class="sd">			Dictionary of annotations</span>
<span class="sd">				{x_point : text}</span>
<span class="sd">			or</span>
<span class="sd">			List of Plotly Annotations</span>
<span class="sd">		is3d : bool</span>
<span class="sd">			Indicates if the layout is for a 3D chart</span>

<span class="sd">		Other Kwargs</span>
<span class="sd">		============</span>

<span class="sd">		Shapes</span>
<span class="sd">			hline : int, list or dict</span>
<span class="sd">				Draws a horizontal line at the</span>
<span class="sd">				indicated y position(s)</span>
<span class="sd">				Extra parameters can be passed in</span>
<span class="sd">				the form of a dictionary (see shapes)</span>
<span class="sd">			vline : int, list or dict</span>
<span class="sd">				Draws a vertical line at the</span>
<span class="sd">				indicated x position(s)</span>
<span class="sd">				Extra parameters can be passed in</span>
<span class="sd">				the form of a dictionary (see shapes)</span>
<span class="sd">			hspan : (y0,y1)</span>
<span class="sd">				Draws a horizontal rectangle at the</span>
<span class="sd">				indicated (y0,y1) positions.</span>
<span class="sd">				Extra parameters can be passed in</span>
<span class="sd">				the form of a dictionary (see shapes)</span>
<span class="sd">			vspan : (x0,x1)</span>
<span class="sd">				Draws a vertical rectangle at the</span>
<span class="sd">				indicated (x0,x1) positions.</span>
<span class="sd">				Extra parameters can be passed in</span>
<span class="sd">				the form of a dictionary (see shapes)</span>
<span class="sd">			shapes : dict or list(dict)</span>
<span class="sd">				List of dictionaries with the</span>
<span class="sd">				specifications of a given shape.</span>
<span class="sd">				See help(cufflinks.tools.get_shape)</span>
<span class="sd">				for more information</span>

<span class="sd">		Axis Ranges</span>
<span class="sd">			xrange : [lower_bound,upper_bound]</span>
<span class="sd">				Sets the range for the x axis</span>
<span class="sd">			yrange : [lower_bound,upper_bound]</span>
<span class="sd">				Sets the range for the y axis</span>
<span class="sd">			zrange : [lower_bound,upper_bound]</span>
<span class="sd">				Sets the range for the z axis</span>

<span class="sd">		Explicit Layout Updates</span>
<span class="sd">			layout_update : dict</span>
<span class="sd">				The layout will be modified with all</span>
<span class="sd">				the explicit values stated in the</span>
<span class="sd">				dictionary</span>

<span class="sd">		Range Selector</span>
<span class="sd">			rangeselector : dict</span>
<span class="sd">				Defines a rangeselector object</span>
<span class="sd">				see help(cf.tools.get_range_selector) for more information</span>
<span class="sd">				Example:</span>
<span class="sd">					{&#39;steps&#39;:[&#39;1y&#39;,&#39;2 months&#39;,&#39;5 weeks&#39;,&#39;ytd&#39;,&#39;2mtd&#39;],</span>
<span class="sd">					 &#39;axis&#39;:&#39;xaxis1&#39;, &#39;bgcolor&#39; : (&#39;blue&#39;,.3),</span>
<span class="sd">					 &#39;x&#39;: 0.2 , &#39;y&#39; : 0.9}</span>

<span class="sd">		Range Slider</span>
<span class="sd">			rangeslider : bool or dict</span>
<span class="sd">				Defines if a rangeslider is displayed</span>
<span class="sd">				If bool: </span>
<span class="sd">					True : Makes it visible</span>
<span class="sd">				if dict:</span>
<span class="sd">					Rangeslider object</span>
<span class="sd">				Example:</span>
<span class="sd">					{&#39;bgcolor&#39;:(&#39;blue&#39;,.3),&#39;autorange&#39;:True}</span>

<span class="sd">		Annotations</span>
<span class="sd">			fontcolor : str</span>
<span class="sd">				Text color for annotations</span>
<span class="sd">			fontsize : int</span>
<span class="sd">				Text size for annotations</span>
<span class="sd">			textangle : int</span>
<span class="sd">				Textt angle </span>
<span class="sd">			See https://plot.ly/python/reference/#layout-annotations </span>
<span class="sd">			for a complete list of valid parameters.</span>
<span class="sd">	&quot;&quot;&quot;</span>


	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
		<span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">__LAYOUT_KWARGS</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid keyword : &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">theme</span><span class="p">:</span>
		<span class="n">theme</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">get_config_file</span><span class="p">()[</span><span class="s1">&#39;theme&#39;</span><span class="p">]</span>

	<span class="n">theme_data</span> <span class="o">=</span> <span class="n">getTheme</span><span class="p">(</span><span class="n">theme</span><span class="p">)</span>
	<span class="n">layout</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">theme_data</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">])</span>
	<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="n">xTitle</span><span class="p">})</span>
	<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;yaxis1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="n">yTitle</span><span class="p">})</span>

	<span class="n">fontfamily</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fontfamily&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">fontfamily</span><span class="p">:</span>
		<span class="n">deep_update</span><span class="p">(</span><span class="n">layout</span><span class="p">,{</span><span class="s1">&#39;font&#39;</span><span class="p">:{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="n">fontfamily</span><span class="p">}})</span>


	<span class="k">if</span> <span class="n">barmode</span><span class="p">:</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;barmode&#39;</span><span class="p">:</span><span class="n">barmode</span><span class="p">})</span>
	<span class="k">if</span> <span class="n">bargroupgap</span><span class="p">:</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;bargroupgap&#39;</span><span class="p">:</span><span class="n">bargroupgap</span><span class="p">})</span>
	<span class="k">if</span> <span class="n">bargap</span><span class="p">:</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bargap</span><span class="o">=</span><span class="n">bargap</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">title</span><span class="p">:</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="n">title</span><span class="p">})</span>
	<span class="k">if</span> <span class="n">annotations</span><span class="p">:</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;annotations&#39;</span><span class="p">:</span><span class="n">annotations</span><span class="p">})</span>


	<span class="k">def</span> <span class="nf">update_axis</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">vals</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">_x</span> <span class="ow">in</span> <span class="n">axis</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">vals</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
				<span class="k">if</span> <span class="n">v</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
					<span class="n">vals</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">layout</span><span class="p">:</span>
				<span class="k">if</span> <span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span><span class="s1">&#39;axis&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
					<span class="n">layout</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">vals</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">layout</span>

	<span class="n">axis_kwargs</span><span class="o">=</span><span class="n">check_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">__LAYOUT_AXIS</span><span class="p">,{},</span><span class="kc">True</span><span class="p">)</span>
	<span class="n">xaxis_kwargs</span><span class="o">=</span><span class="n">kwargs_from_keyword</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,{},</span><span class="s1">&#39;xaxis&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
	<span class="n">yaxis_kwargs</span><span class="o">=</span><span class="n">kwargs_from_keyword</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,{},</span><span class="s1">&#39;yaxis&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
	
	<span class="k">for</span> <span class="n">_x</span><span class="p">,</span><span class="n">_vals</span> <span class="ow">in</span> <span class="p">((</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span><span class="n">axis_kwargs</span><span class="p">),(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">xaxis_kwargs</span><span class="p">),(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">yaxis_kwargs</span><span class="p">)):</span>
		<span class="n">layout</span><span class="o">=</span><span class="n">update_axis</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span><span class="n">_x</span><span class="p">,</span><span class="o">**</span><span class="n">_vals</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">margin</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margin</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
			<span class="n">margin</span><span class="o">=</span><span class="n">margin</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">((</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">),</span><span class="n">margin</span><span class="p">)))</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">dimensions</span><span class="p">:</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

	<span class="k">if</span> <span class="n">height</span><span class="p">:</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">width</span><span class="p">:</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">is3d</span><span class="p">:</span>
		<span class="k">if</span> <span class="s1">&#39;3d&#39;</span> <span class="ow">in</span> <span class="n">theme_data</span><span class="p">:</span>
			<span class="n">layout</span><span class="o">=</span><span class="n">deep_update</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span><span class="n">theme_data</span><span class="p">[</span><span class="s1">&#39;3d&#39;</span><span class="p">])</span>
		<span class="n">zaxis</span><span class="o">=</span><span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">zaxis</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">zTitle</span><span class="p">)</span>
		<span class="n">scene</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">yaxis</span><span class="o">=</span><span class="n">layout</span><span class="p">[</span><span class="s1">&#39;yaxis1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">)</span>
		<span class="n">layout</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="n">scene</span><span class="p">)</span>
		<span class="k">del</span> <span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">]</span>
		<span class="k">del</span> <span class="n">layout</span><span class="p">[</span><span class="s1">&#39;yaxis1&#39;</span><span class="p">]</span>

	<span class="c1">## Axis Range</span>
	<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]:</span>
		<span class="k">if</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">range&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">is3d</span><span class="p">:</span>
				<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;scene&#39;</span><span class="p">][</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">axis&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">range&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">)])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">axis1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">range&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">)])</span>

	<span class="c1"># Need to update this for an add_axis approach. </span>
	<span class="k">if</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;candlestick&#39;</span><span class="p">,</span><span class="s1">&#39;ohlc&#39;</span><span class="p">,</span><span class="s1">&#39;candle&#39;</span><span class="p">):</span>
		<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;yaxis2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">layout</span><span class="p">[</span><span class="s1">&#39;yaxis1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;yaxis1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

	<span class="c1">## Kwargs</span>

	<span class="k">if</span> <span class="s1">&#39;legend&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">bool</span><span class="p">:</span>
			<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;showlegend&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]</span>
		<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;top&#39;</span><span class="p">:</span>
				<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">y</span><span class="o">=.</span><span class="mi">95</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
				<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">y</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span>
			<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;showlegend&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]</span>
			<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;showlegend&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>

	<span class="k">if</span> <span class="s1">&#39;showlegend&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
		<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;showlegend&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;showlegend&#39;</span><span class="p">]</span>

	<span class="c1"># Logarithmic Axis</span>
	<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]:</span>
		<span class="k">if</span> <span class="s1">&#39;log</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">is3d</span><span class="p">:</span>			
				<span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;log</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_</span><span class="p">)]:</span>
					<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;scene&#39;</span><span class="p">][</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">axis&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_</span><span class="p">)][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;log&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;log</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_</span><span class="p">)]:</span>
					<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">axis1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_</span><span class="p">)][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;log&#39;</span>

	<span class="c1"># Shapes</span>

	<span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;vline&#39;</span><span class="p">,</span><span class="s1">&#39;hline&#39;</span><span class="p">,</span><span class="s1">&#39;shapes&#39;</span><span class="p">,</span><span class="s1">&#39;hspan&#39;</span><span class="p">,</span><span class="s1">&#39;vspan&#39;</span><span class="p">]):</span>
		<span class="n">shapes</span><span class="o">=</span><span class="p">[]</span>

		<span class="k">def</span> <span class="nf">get_shapes</span><span class="p">(</span><span class="n">xline</span><span class="p">):</span>
			<span class="n">orientation</span><span class="o">=</span><span class="n">xline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">xline</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="n">xline</span><span class="p">]</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xline</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">x_i</span> <span class="ow">in</span> <span class="n">xline</span><span class="p">:</span>
					<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x_i</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
						<span class="n">x_i</span><span class="p">[</span><span class="s1">&#39;kind&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;line&#39;</span>
						<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="o">**</span><span class="n">x_i</span><span class="p">))</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">orientation</span><span class="o">==</span><span class="s1">&#39;h&#39;</span><span class="p">:</span>
							<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">x_i</span><span class="p">))</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x_i</span><span class="p">))</span>
			<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xline</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
				<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="o">**</span><span class="n">xline</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">orientation</span><span class="o">==</span><span class="s1">&#39;h&#39;</span><span class="p">:</span>
					<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">xline</span><span class="p">))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">xline</span><span class="p">))</span>

		<span class="k">def</span> <span class="nf">get_span</span><span class="p">(</span><span class="n">xspan</span><span class="p">):</span>
			<span class="n">orientation</span><span class="o">=</span><span class="n">xspan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">xspan</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="n">xspan</span><span class="p">]</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xspan</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">x_i</span> <span class="ow">in</span> <span class="n">xspan</span><span class="p">:</span>
					<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x_i</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
						<span class="n">x_i</span><span class="p">[</span><span class="s1">&#39;kind&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;rect&#39;</span>
						<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="o">**</span><span class="n">x_i</span><span class="p">))</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">v0</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">x_i</span>
						<span class="k">if</span> <span class="n">orientation</span><span class="o">==</span><span class="s1">&#39;h&#39;</span><span class="p">:</span>
							<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">opacity</span><span class="o">=.</span><span class="mi">5</span><span class="p">))</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span><span class="n">x1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">opacity</span><span class="o">=.</span><span class="mi">5</span><span class="p">))</span>
			<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xspan</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
				<span class="n">xspan</span><span class="p">[</span><span class="s1">&#39;kind&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;rect&#39;</span>
				<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="o">**</span><span class="n">xspan</span><span class="p">))</span>
			<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xspan</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
				<span class="n">v0</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">xspan</span>
				<span class="k">if</span> <span class="n">orientation</span><span class="o">==</span><span class="s1">&#39;h&#39;</span><span class="p">:</span>
					<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">opacity</span><span class="o">=.</span><span class="mi">5</span><span class="p">))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span><span class="n">x1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">opacity</span><span class="o">=.</span><span class="mi">5</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Invalid value for </span><span class="si">{0}</span><span class="s1">span: </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orientation</span><span class="p">,</span><span class="n">xspan</span><span class="p">))</span>

		<span class="k">if</span> <span class="s1">&#39;hline&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
			<span class="n">get_shapes</span><span class="p">(</span><span class="s1">&#39;hline&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="s1">&#39;vline&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
			<span class="n">get_shapes</span><span class="p">(</span><span class="s1">&#39;vline&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="s1">&#39;hspan&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
			<span class="n">get_span</span><span class="p">(</span><span class="s1">&#39;hspan&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="s1">&#39;vspan&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
			<span class="n">get_span</span><span class="p">(</span><span class="s1">&#39;vspan&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="s1">&#39;shapes&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
			<span class="n">shapes_</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;shapes&#39;</span><span class="p">]</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes_</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shapes_</span><span class="p">:</span>
					<span class="n">shp</span><span class="o">=</span><span class="n">i</span> <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">else</span> <span class="n">get_shape</span><span class="p">(</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
					<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
			<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes_</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
					<span class="n">shp</span><span class="o">=</span><span class="n">shapes_</span> <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">shapes_</span> <span class="k">else</span> <span class="n">get_shape</span><span class="p">(</span><span class="o">**</span><span class="n">shapes_</span><span class="p">)</span>
					<span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Shapes need to be either a dict or list of dicts&quot;</span><span class="p">)</span>


		<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;shapes&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">shapes</span>

	<span class="c1"># Maps</span>
	<span class="k">if</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;choropleth&#39;</span><span class="p">,</span><span class="s1">&#39;scattergeo&#39;</span><span class="p">):</span>
		<span class="n">kw</span><span class="o">=</span><span class="n">check_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span><span class="n">__GEO_KWARGS</span><span class="p">)</span>
		<span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;equirectangular&#39;</span><span class="p">},</span><span class="s1">&#39;showframe&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;showcoastlines&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
		<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
			<span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
				<span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
		<span class="n">kw_</span><span class="o">=</span><span class="n">kwargs_from_keyword</span><span class="p">(</span><span class="n">kw</span><span class="p">,{},</span><span class="s1">&#39;projection&#39;</span><span class="p">)</span>
		<span class="n">deep_update</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span><span class="n">kw_</span><span class="p">)</span>
		<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;geo&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kw</span>
		<span class="k">del</span> <span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">]</span>
		<span class="k">del</span> <span class="n">layout</span><span class="p">[</span><span class="s1">&#39;yaxis1&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">margin</span><span class="p">:</span>
			<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;margin&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;autoexpand&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>

	<span class="c1"># Range Selector</span>
	<span class="k">if</span> <span class="s1">&#39;rangeselector&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
		<span class="n">rs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rangeselector&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="s1">&#39;axis&#39;</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">:</span>
			<span class="n">axis</span><span class="o">=</span><span class="n">rs</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">]</span>
			<span class="k">del</span> <span class="n">rs</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">axis</span><span class="o">=</span><span class="s1">&#39;xaxis1&#39;</span>
		<span class="n">layout</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;rangeselector&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">get_range_selector</span><span class="p">(</span><span class="o">**</span><span class="n">rs</span><span class="p">)</span>

	<span class="c1"># Range Slider</span>
	<span class="k">if</span> <span class="s1">&#39;rangeslider&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rangeslider&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">bool</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rangeslider&#39;</span><span class="p">]:</span>
				<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">][</span><span class="s1">&#39;rangeslider&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rangeslider&#39;</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">][</span><span class="s1">&#39;rangeslider&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
				<span class="c1"># layout[&#39;yaxis1&#39;].update(domain=(0,0))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">][</span><span class="s1">&#39;rangeslider&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rangeslider&#39;</span><span class="p">]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ohlc&#39;</span><span class="p">,</span><span class="s1">&#39;candle&#39;</span><span class="p">,</span><span class="s1">&#39;candlestick&#39;</span><span class="p">):</span>
			<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">][</span><span class="s1">&#39;rangeslider&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="c1"># layout[&#39;yaxis1&#39;].update(domain=(0,0))</span>



	<span class="c1"># Explicit Updates</span>

	<span class="k">if</span> <span class="s1">&#39;layout_update&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
		<span class="n">layout</span><span class="o">=</span><span class="n">deep_update</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;layout_update&#39;</span><span class="p">])</span>

	<span class="k">def</span> <span class="nf">updateColors</span><span class="p">(</span><span class="n">layout</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">layout</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
				<span class="n">updateColors</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
					<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
						<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
							<span class="n">updateColors</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
				<span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
					<span class="k">if</span> <span class="s1">&#39;rgba&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
						<span class="n">layout</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">normalize</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">layout</span>


	<span class="k">return</span> <span class="n">updateColors</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span></div>


<div class="viewcode-block" id="getAnnotations"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.getAnnotations">[docs]</a><span class="k">def</span> <span class="nf">getAnnotations</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">annotations</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span><span class="n">theme</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generates an annotations object</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		df : DataFrame</span>
<span class="sd">			Original DataFrame of values</span>
<span class="sd">		annotations : dict or list</span>
<span class="sd">			Dictionary of annotations</span>
<span class="sd">			{x_point : text}</span>
<span class="sd">			or</span>
<span class="sd">			List of Plotly annotations</span>
<span class="sd">	&quot;&quot;&quot;</span>
	


	

	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
		<span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">__ANN_KWARGS</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid keyword : &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

	<span class="n">l</span><span class="o">=</span><span class="p">[]</span>
	<span class="n">theme_data</span> <span class="o">=</span> <span class="n">getTheme</span><span class="p">(</span><span class="n">theme</span><span class="p">)</span>

	<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontcolor&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fontcolor&#39;</span><span class="p">,</span><span class="n">theme_data</span><span class="p">[</span><span class="s1">&#39;annotations&#39;</span><span class="p">][</span><span class="s1">&#39;fontcolor&#39;</span><span class="p">])</span>
	<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;arrowcolor&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;arrowcolor&#39;</span><span class="p">,</span><span class="n">theme_data</span><span class="p">[</span><span class="s1">&#39;annotations&#39;</span><span class="p">][</span><span class="s1">&#39;arrowcolor&#39;</span><span class="p">])</span>
	<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fontsize&#39;</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">check_ann</span><span class="p">(</span><span class="n">annotation</span><span class="p">):</span>
		<span class="n">local_list</span><span class="o">=</span><span class="p">[]</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">_annotation</span><span class="o">=</span><span class="n">dict_replace_keyword</span><span class="p">({},</span><span class="s1">&#39;font&#39;</span><span class="p">,</span><span class="n">annotation</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
			<span class="n">_annotation</span><span class="o">=</span><span class="n">dict_replace_keyword</span><span class="p">(</span><span class="n">_annotation</span><span class="p">,</span><span class="s1">&#39;font&#39;</span><span class="p">,</span><span class="n">kwargs</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
			<span class="n">local_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Annotation</span><span class="p">(</span><span class="n">_annotation</span><span class="p">))</span>
			
		<span class="k">except</span><span class="p">:</span>
			<span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">:</span>
				<span class="n">local_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
						<span class="n">go</span><span class="o">.</span><span class="n">Annotation</span><span class="p">(</span>	
								<span class="n">text</span><span class="o">=</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
								<span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
								<span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
								<span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
								<span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
								<span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
								<span class="n">font</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">24</span> <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;fontsize&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]}</span>
							<span class="p">)</span>
					<span class="p">)</span>
				<span class="k">del</span> <span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
		
			<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
				<span class="k">if</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;candlestick&#39;</span><span class="p">,</span><span class="s1">&#39;ohlc&#39;</span><span class="p">,</span><span class="s1">&#39;candle&#39;</span><span class="p">):</span>
					<span class="n">d</span><span class="o">=</span><span class="n">ta</span><span class="o">.</span><span class="n">_ohlc_dict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
					<span class="n">maxv</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
					<span class="n">yref</span><span class="o">=</span><span class="s1">&#39;y2&#39;</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">maxv</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="k">else</span> <span class="mi">0</span>
					<span class="n">yref</span><span class="o">=</span><span class="s1">&#39;y1&#39;</span>
				<span class="n">ann</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Annotation</span><span class="p">(</span>
								<span class="n">x</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
								<span class="n">y</span><span class="o">=</span><span class="n">maxv</span><span class="p">,</span>
								<span class="n">xref</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
								<span class="n">yref</span><span class="o">=</span><span class="n">yref</span><span class="p">,</span>
								<span class="n">text</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
								<span class="n">showarrow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
								<span class="n">arrowhead</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
								<span class="n">ax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
								<span class="n">ay</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span>
								<span class="n">textangle</span><span class="o">=-</span><span class="mi">90</span>
								<span class="p">)</span>
				<span class="n">local_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ann</span><span class="p">)</span>

			<span class="n">_l</span><span class="o">=</span><span class="p">[]</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local_list</span><span class="p">:</span>
				<span class="n">_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_replace_keyword</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;font&#39;</span><span class="p">,</span><span class="n">kwargs</span><span class="p">,</span><span class="kc">True</span><span class="p">))</span>
			
			<span class="n">local_list</span><span class="o">=</span><span class="n">_l</span>

		<span class="k">return</span> <span class="n">local_list</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotations</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
		<span class="n">annotations</span><span class="o">=</span><span class="p">[</span><span class="n">annotations</span><span class="p">]</span>	
	<span class="n">_list_ann</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">for</span> <span class="n">ann</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
		<span class="n">_list_ann</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">check_ann</span><span class="p">(</span><span class="n">ann</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">go</span><span class="o">.</span><span class="n">Annotations</span><span class="p">(</span><span class="n">_list_ann</span><span class="p">)</span></div>


<div class="viewcode-block" id="strip_figures"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.strip_figures">[docs]</a><span class="k">def</span> <span class="nf">strip_figures</span><span class="p">(</span><span class="n">figure</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Strips a figure into multiple figures with a trace on each of them</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		figure : Figure</span>
<span class="sd">			Plotly Figure</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">fig</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">trace</span><span class="p">],</span><span class="n">layout</span><span class="o">=</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]))</span>
	<span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="get_base_layout"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_base_layout">[docs]</a><span class="k">def</span> <span class="nf">get_base_layout</span><span class="p">(</span><span class="n">figs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generates a layout with the union of all properties of multiple</span>
<span class="sd">	figures&#39; layouts</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		fig : list(Figures)</span>
<span class="sd">			List of Plotly Figures</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">layout</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figs</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
			<span class="n">layout</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
	<span class="k">return</span> <span class="n">layout</span></div>

<div class="viewcode-block" id="figures"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.figures">[docs]</a><span class="k">def</span> <span class="nf">figures</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">specs</span><span class="p">,</span><span class="n">asList</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generates multiple Plotly figures for a given DataFrame</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		df : DataFrame</span>
<span class="sd">			Pandas DataFrame</span>
<span class="sd">		specs : list(dict)</span>
<span class="sd">			List of dictionaries with the properties</span>
<span class="sd">			of each figure.</span>
<span class="sd">			All properties avaialbe can be seen with</span>
<span class="sd">			help(cufflinks.pd.DataFrame.iplot)</span>
<span class="sd">		asList : boolean</span>
<span class="sd">			If True, then a list of figures is returned.</span>
<span class="sd">			Otherwise a single (merged) figure is returned.</span>
<span class="sd">			Default : False</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">figs</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
		<span class="n">figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="o">**</span><span class="n">spec</span><span class="p">))</span>
	<span class="k">if</span> <span class="n">asList</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">figs</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">merge_figures</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span></div>

<div class="viewcode-block" id="merge_figures"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.merge_figures">[docs]</a><span class="k">def</span> <span class="nf">merge_figures</span><span class="p">(</span><span class="n">figures</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generates a single Figure from a list of figures</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		figures : list(Figures)</span>
<span class="sd">			List of figures to be merged. </span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">figure</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
	<span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Data</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
			<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
	<span class="n">layout</span><span class="o">=</span><span class="n">get_base_layout</span><span class="p">(</span><span class="n">figures</span><span class="p">)</span>
	<span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span>
	<span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">layout</span>
	<span class="k">return</span> <span class="n">figure</span></div>

<div class="viewcode-block" id="subplots"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.subplots">[docs]</a><span class="k">def</span> <span class="nf">subplots</span><span class="p">(</span><span class="n">figures</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
				  <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shared_yaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
				  <span class="n">start_cell</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">base_layout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
				  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generates a subplot view for a set of figures</span>
<span class="sd">	This is a wrapper for plotly.tools.make_subplots</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		figures : [Figures]</span>
<span class="sd">			List of Plotly Figures</span>
<span class="sd">		shape : (rows,cols)</span>
<span class="sd">			Tuple indicating the size of rows and columns</span>
<span class="sd">			If omitted then the layout is automatically set</span>
<span class="sd">		shared_xaxes : bool</span>
<span class="sd">			Assign shared x axes.</span>
<span class="sd">			If True, subplots in the same grid column have one common</span>
<span class="sd">			shared x-axis at the bottom of the grid.</span>
<span class="sd">		shared_yaxes : bool</span>
<span class="sd">			Assign shared y axes.</span>
<span class="sd">			If True, subplots in the same grid row have one common</span>
<span class="sd">			shared y-axis on the left-hand side of the grid.</span>
<span class="sd">		start_cell : string</span>
<span class="sd">				&#39;bottom-left&#39;</span>
<span class="sd">				&#39;top-left&#39;</span>
<span class="sd">			Choose the starting cell in the subplot grid used to set the</span>
<span class="sd">			domains of the subplots.</span>
<span class="sd">		theme : string</span>
<span class="sd">			Layout Theme</span>
<span class="sd">				solar</span>
<span class="sd">				pearl</span>
<span class="sd">				white</span>
<span class="sd">			see cufflinks.getThemes() for all</span>
<span class="sd">			available themes</span>
<span class="sd">		base_layout : layout (dict)</span>
<span class="sd">			Layout to be used as base where the subplots will be</span>
<span class="sd">			added</span>
<span class="sd">		subplot_titles : list(string)</span>
<span class="sd">			List of strings that contains the titles of each</span>
<span class="sd">			plot.</span>
<span class="sd">		horizontal_spacing : float</span>
<span class="sd">				[0,1]</span>
<span class="sd">			Space between subplot columns.</span>
<span class="sd">		vertical_spacing : float</span>
<span class="sd">			Space between subplot rows.</span>
<span class="sd">		specs : list of dicts</span>
<span class="sd">			Subplot specifications.</span>
<span class="sd">				ex1: specs=[[{}, {}], [{&#39;colspan&#39;: 2}, None]]</span>
<span class="sd">				ex2: specs=[[{&#39;rowspan&#39;: 2}, {}], [None, {}]]</span>

<span class="sd">			- Indices of the outer list correspond to subplot grid rows</span>
<span class="sd">			  starting from the bottom. The number of rows in &#39;specs&#39;</span>
<span class="sd">			  must be equal to &#39;rows&#39;.</span>

<span class="sd">			- Indices of the inner lists correspond to subplot grid columns</span>
<span class="sd">			  starting from the left. The number of columns in &#39;specs&#39;</span>
<span class="sd">			  must be equal to &#39;cols&#39;.</span>

<span class="sd">			- Each item in the &#39;specs&#39; list corresponds to one subplot</span>
<span class="sd">			  in a subplot grid. (N.B. The subplot grid has exactly &#39;rows&#39;</span>
<span class="sd">			  times &#39;cols&#39; cells.)</span>

<span class="sd">			- Use None for blank a subplot cell (or to move pass a col/row span).</span>

<span class="sd">			- Note that specs[0][0] has the specs of the &#39;start_cell&#39; subplot.</span>

<span class="sd">			- Each item in &#39;specs&#39; is a dictionary.</span>
<span class="sd">				The available keys are:</span>

<span class="sd">				* is_3d (boolean, default=False): flag for 3d scenes</span>
<span class="sd">				* colspan (int, default=1): number of subplot columns</span>
<span class="sd">					for this subplot to span.</span>
<span class="sd">				* rowspan (int, default=1): number of subplot rows</span>
<span class="sd">					for this subplot to span.</span>
<span class="sd">				* l (float, default=0.0): padding left of cell</span>
<span class="sd">				* r (float, default=0.0): padding right of cell</span>
<span class="sd">				* t (float, default=0.0): padding right of cell</span>
<span class="sd">				* b (float, default=0.0): padding bottom of cell</span>

<span class="sd">			- Use &#39;horizontal_spacing&#39; and &#39;vertical_spacing&#39; to adjust</span>
<span class="sd">			  the spacing in between the subplots.</span>

<span class="sd">		insets : list of dicts</span>
<span class="sd">			Inset specifications.</span>

<span class="sd">			- Each item in &#39;insets&#39; is a dictionary.</span>
<span class="sd">				The available keys are:</span>

<span class="sd">				* cell (tuple, default=(1,1)): (row, col) index of the</span>
<span class="sd">					subplot cell to overlay inset axes onto.</span>
<span class="sd">				* is_3d (boolean, default=False): flag for 3d scenes</span>
<span class="sd">				* l (float, default=0.0): padding left of inset</span>
<span class="sd">					  in fraction of cell width</span>
<span class="sd">				* w (float or &#39;to_end&#39;, default=&#39;to_end&#39;) inset width</span>
<span class="sd">					  in fraction of cell width (&#39;to_end&#39;: to cell right edge)</span>
<span class="sd">				* b (float, default=0.0): padding bottom of inset</span>
<span class="sd">					  in fraction of cell height</span>
<span class="sd">				* h (float or &#39;to_end&#39;, default=&#39;to_end&#39;) inset height</span>
<span class="sd">					  in fraction of cell height (&#39;to_end&#39;: to cell top edge)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">figures</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
		<span class="n">figures</span><span class="o">=</span><span class="p">[</span><span class="n">figures</span><span class="p">]</span>

	<span class="k">if</span> <span class="n">shape</span><span class="p">:</span>
		<span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="n">shape</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">)</span><span class="o">&gt;</span><span class="n">rows</span><span class="o">*</span><span class="n">cols</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid shape for the number of figures given&quot;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
			<span class="n">cols</span><span class="o">=</span><span class="mi">1</span>
			<span class="n">rows</span><span class="o">=</span><span class="mi">1</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">cols</span><span class="o">=</span><span class="mi">2</span>
			<span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span>
	<span class="n">sp</span><span class="o">=</span><span class="n">get_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
				  <span class="n">shared_xaxes</span><span class="o">=</span><span class="n">shared_xaxes</span><span class="p">,</span> <span class="n">shared_yaxes</span><span class="o">=</span><span class="n">shared_yaxes</span><span class="p">,</span>
				  <span class="n">start_cell</span><span class="o">=</span><span class="n">start_cell</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="n">theme</span><span class="p">,</span><span class="n">base_layout</span><span class="o">=</span><span class="n">base_layout</span><span class="p">,</span>
				  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	<span class="n">list_ref</span><span class="o">=</span><span class="p">(</span><span class="n">col</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">_grid_ref</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">)):</span>
		<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
			<span class="n">lr</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">list_ref</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">lr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">break</span>
		<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
			<span class="k">for</span> <span class="n">axe</span> <span class="ow">in</span> <span class="n">lr</span><span class="p">:</span>
				<span class="n">_</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">axis&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">axe</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span><span class="n">axe</span><span class="p">})</span>
			<span class="n">sp</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
	<span class="c1"># Remove extra plots</span>
	<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sp</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">):</span>
				<span class="k">del</span> <span class="n">sp</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>

	<span class="c1"># Check for non-cartesian plots</span>
	<span class="n">data</span><span class="o">=</span><span class="n">sp</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
	<span class="n">layout</span><span class="o">=</span><span class="n">sp</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;pie&#39;</span><span class="p">:</span>
			<span class="n">d</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
			<span class="n">d</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;xaxis&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])][</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span>
			<span class="n">d</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">layout</span><span class="p">[</span><span class="s1">&#39;yaxis</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;yaxis&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])][</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">sp</span></div>


<div class="viewcode-block" id="get_subplots"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_subplots">[docs]</a><span class="k">def</span> <span class="nf">get_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
				  <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shared_yaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
				  <span class="n">start_cell</span><span class="o">=</span><span class="s1">&#39;top-left&#39;</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">base_layout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
				  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generates a subplot view for a set of figures</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		rows : int</span>
<span class="sd">			Number of rows</span>
<span class="sd">		cols : int</span>
<span class="sd">			Number of cols</span>
<span class="sd">		shared_xaxes : bool</span>
<span class="sd">			Assign shared x axes.</span>
<span class="sd">			If True, subplots in the same grid column have one common</span>
<span class="sd">			shared x-axis at the bottom of the gird.</span>
<span class="sd">		shared_yaxes : bool</span>
<span class="sd">			Assign shared y axes.</span>
<span class="sd">			If True, subplots in the same grid row have one common</span>
<span class="sd">			shared y-axis on the left-hand side of the gird.</span>
<span class="sd">		start_cell : string</span>
<span class="sd">				&#39;bottom-left&#39;</span>
<span class="sd">				&#39;top-left&#39;</span>
<span class="sd">			Choose the starting cell in the subplot grid used to set the</span>
<span class="sd">			domains of the subplots.</span>
<span class="sd">		theme : string</span>
<span class="sd">			Layout Theme</span>
<span class="sd">				solar</span>
<span class="sd">				pearl</span>
<span class="sd">				white</span>
<span class="sd">			see cufflinks.getThemes() for all</span>
<span class="sd">			available themes</span>
<span class="sd">		horizontal_spacing : float</span>
<span class="sd">				[0,1]</span>
<span class="sd">			Space between subplot columns.</span>
<span class="sd">		vertical_spacing : float</span>
<span class="sd">			Space between subplot rows.</span>
<span class="sd">		specs : list of dicts</span>
<span class="sd">			Subplot specifications.</span>
<span class="sd">				ex1: specs=[[{}, {}], [{&#39;colspan&#39;: 2}, None]]</span>
<span class="sd">				ex2: specs=[[{&#39;rowspan&#39;: 2}, {}], [None, {}]]</span>

<span class="sd">			- Indices of the outer list correspond to subplot grid rows</span>
<span class="sd">			  starting from the bottom. The number of rows in &#39;specs&#39;</span>
<span class="sd">			  must be equal to &#39;rows&#39;.</span>

<span class="sd">			- Indices of the inner lists correspond to subplot grid columns</span>
<span class="sd">			  starting from the left. The number of columns in &#39;specs&#39;</span>
<span class="sd">			  must be equal to &#39;cols&#39;.</span>

<span class="sd">			- Each item in the &#39;specs&#39; list corresponds to one subplot</span>
<span class="sd">			  in a subplot grid. (N.B. The subplot grid has exactly &#39;rows&#39;</span>
<span class="sd">			  times &#39;cols&#39; cells.)</span>

<span class="sd">			- Use None for blank a subplot cell (or to move pass a col/row span).</span>

<span class="sd">			- Note that specs[0][0] has the specs of the &#39;start_cell&#39; subplot.</span>

<span class="sd">			- Each item in &#39;specs&#39; is a dictionary.</span>
<span class="sd">				The available keys are:</span>

<span class="sd">				* is_3d (boolean, default=False): flag for 3d scenes</span>
<span class="sd">				* colspan (int, default=1): number of subplot columns</span>
<span class="sd">					for this subplot to span.</span>
<span class="sd">				* rowspan (int, default=1): number of subplot rows</span>
<span class="sd">					for this subplot to span.</span>
<span class="sd">				* l (float, default=0.0): padding left of cell</span>
<span class="sd">				* r (float, default=0.0): padding right of cell</span>
<span class="sd">				* t (float, default=0.0): padding right of cell</span>
<span class="sd">				* b (float, default=0.0): padding bottom of cell</span>

<span class="sd">			- Use &#39;horizontal_spacing&#39; and &#39;vertical_spacing&#39; to adjust</span>
<span class="sd">			  the spacing in between the subplots.</span>

<span class="sd">		insets : list of dicts</span>
<span class="sd">			Inset specifications.</span>

<span class="sd">			- Each item in &#39;insets&#39; is a dictionary.</span>
<span class="sd">				The available keys are:</span>

<span class="sd">				* cell (tuple, default=(1,1)): (row, col) index of the</span>
<span class="sd">					subplot cell to overlay inset axes onto.</span>
<span class="sd">				* is_3d (boolean, default=False): flag for 3d scenes</span>
<span class="sd">				* l (float, default=0.0): padding left of inset</span>
<span class="sd">					  in fraction of cell width</span>
<span class="sd">				* w (float or &#39;to_end&#39;, default=&#39;to_end&#39;) inset width</span>
<span class="sd">					  in fraction of cell width (&#39;to_end&#39;: to cell right edge)</span>
<span class="sd">				* b (float, default=0.0): padding bottom of inset</span>
<span class="sd">					  in fraction of cell height</span>
<span class="sd">				* h (float or &#39;to_end&#39;, default=&#39;to_end&#39;) inset height</span>
<span class="sd">					  in fraction of cell height (&#39;to_end&#39;: to cell top edge)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">theme</span><span class="p">:</span>
		<span class="n">theme</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">get_config_file</span><span class="p">()[</span><span class="s1">&#39;theme&#39;</span><span class="p">]</span>

	<span class="n">layout</span><span class="o">=</span> <span class="n">base_layout</span> <span class="k">if</span> <span class="n">base_layout</span> <span class="k">else</span> <span class="n">getLayout</span><span class="p">(</span><span class="n">theme</span><span class="p">)</span>
	<span class="n">sp</span><span class="o">=</span><span class="n">py</span><span class="o">.</span><span class="n">plotly</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="n">shared_xaxes</span><span class="o">=</span><span class="n">shared_xaxes</span><span class="p">,</span>
										   <span class="n">shared_yaxes</span><span class="o">=</span><span class="n">shared_yaxes</span><span class="p">,</span><span class="n">print_grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
											<span class="n">start_cell</span><span class="o">=</span><span class="n">start_cell</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">layout</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">go</span><span class="o">.</span><span class="n">XAxis</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">go</span><span class="o">.</span><span class="n">YAxis</span><span class="p">):</span>
			<span class="n">sp</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="n">v</span><span class="p">})</span>

	<span class="c1"># if &#39;subplot_titles&#39; in kwargs:</span>
	<span class="c1"># 	if &#39;annotations&#39; in layout:</span>
	<span class="c1"># 		annotation=sp[&#39;layout&#39;][&#39;annotations&#39;][0]</span>
	<span class="c1"># 	else:</span>
	<span class="c1"># 		annotation=getLayout(theme,annotations=[Annotation(text=&#39;&#39;)])[&#39;annotations&#39;]</span>
	<span class="c1"># 	for ann in sp[&#39;layout&#39;][&#39;annotations&#39;]:</span>
	<span class="c1"># 		ann.update(font=dict(color=annotation[&#39;font&#39;][&#39;color&#39;]))</span>

	<span class="k">def</span> <span class="nf">update_items</span><span class="p">(</span><span class="n">sp_item</span><span class="p">,</span><span class="n">layout</span><span class="p">,</span><span class="n">axis</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">layout</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
			<span class="n">sp_item</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="n">v</span><span class="p">})</span>

	<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sp</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">go</span><span class="o">.</span><span class="n">XAxis</span><span class="p">):</span>
			<span class="n">update_items</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">layout</span><span class="p">,</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">go</span><span class="o">.</span><span class="n">YAxis</span><span class="p">):</span>
			<span class="n">update_items</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">layout</span><span class="p">,</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">sp</span></div>

<span class="c1"># Candlesticks and OHLC</span>


<div class="viewcode-block" id="get_ohlc"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_ohlc">[docs]</a><span class="k">def</span> <span class="nf">get_ohlc</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">up_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">down_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">theme</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="n">layout</span><span class="o">=</span><span class="n">getLayout</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">theme</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">layout</span> <span class="k">else</span> <span class="n">layout</span>
	<span class="n">ohlc</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">,</span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;close&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">theme</span><span class="p">:</span>
		<span class="n">theme</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">get_config_file</span><span class="p">()[</span><span class="s1">&#39;theme&#39;</span><span class="p">]</span>
	<span class="n">c_dir</span><span class="o">=</span><span class="n">ta</span><span class="o">.</span><span class="n">_ohlc_dict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
	<span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">c_dir</span><span class="p">[</span><span class="n">_</span><span class="p">]]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ohlc</span><span class="p">]</span>
	<span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
	<span class="n">fig</span><span class="o">=</span><span class="n">py</span><span class="o">.</span><span class="n">plotly</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">FigureFactory</span><span class="o">.</span><span class="n">create_ohlc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	<span class="n">ohlc_bars</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
	<span class="n">ohlc_bars</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
	<span class="n">ohlc_bars</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span>
	<span class="n">data</span><span class="o">=</span><span class="n">ohlc_bars</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">up_color</span><span class="p">:</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">normalize</span><span class="p">(</span><span class="n">up_color</span><span class="p">))</span>
	<span class="k">if</span> <span class="n">down_color</span><span class="p">:</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">normalize</span><span class="p">(</span><span class="n">down_color</span><span class="p">))</span>
	<span class="n">ohlc_bars</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;hovermode&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;closest&#39;</span>
	<span class="n">ohlc_bars</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">merge_dict</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span><span class="n">ohlc_bars</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">ohlc_bars</span></div>

<div class="viewcode-block" id="get_candle"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_candle">[docs]</a><span class="k">def</span> <span class="nf">get_candle</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">up_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">down_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">theme</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="n">layout</span><span class="o">=</span><span class="n">getLayout</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="n">theme</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">layout</span> <span class="k">else</span> <span class="n">layout</span>
	<span class="n">ohlc</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;open&#39;</span><span class="p">,</span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;close&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">theme</span><span class="p">:</span>
		<span class="n">theme</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">get_config_file</span><span class="p">()[</span><span class="s1">&#39;theme&#39;</span><span class="p">]</span>
	<span class="n">c_dir</span><span class="o">=</span><span class="n">ta</span><span class="o">.</span><span class="n">_ohlc_dict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
	<span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">c_dir</span><span class="p">[</span><span class="n">_</span><span class="p">]]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ohlc</span><span class="p">]</span>
	<span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
	<span class="n">fig</span><span class="o">=</span><span class="n">py</span><span class="o">.</span><span class="n">plotly</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">FigureFactory</span><span class="o">.</span><span class="n">create_candlestick</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	<span class="n">candle</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
	<span class="n">candle</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
	<span class="n">candle</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">layout</span>
	<span class="n">data</span><span class="o">=</span><span class="n">candle</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
	<span class="k">def</span> <span class="nf">update_color</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">color</span><span class="p">):</span>
		<span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;fillcolor&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">normalize</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		<span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">normalize</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
	<span class="k">if</span> <span class="n">up_color</span><span class="p">:</span>
		<span class="n">update_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">up_color</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">down_color</span><span class="p">:</span>
		<span class="n">update_color</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">down_color</span><span class="p">)</span>
	<span class="n">candle</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;hovermode&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;closest&#39;</span>
	<span class="n">candle</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">merge_dict</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span><span class="n">candle</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">candle</span></div>

<div class="viewcode-block" id="scatter_matrix"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.scatter_matrix">[docs]</a><span class="k">def</span> <span class="nf">scatter_matrix</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">theme</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Displays a matrix with scatter plot for each pair of</span>
<span class="sd">	Series in the DataFrame.</span>
<span class="sd">	The diagonal shows a histogram for each of the Series</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		df : DataFrame</span>
<span class="sd">			Pandas DataFrame</span>
<span class="sd">		theme : string</span>
<span class="sd">			Theme to be used (if not the default)</span>
<span class="sd">		bins : int</span>
<span class="sd">			Number of bins to use for histogram</span>
<span class="sd">		color : string</span>
<span class="sd">			Color to be used for each scatter plot</span>
<span class="sd">		size : int</span>
<span class="sd">			Size for each marker on the scatter plot</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">theme</span><span class="p">:</span>
		<span class="n">theme</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">get_config_file</span><span class="p">()[</span><span class="s1">&#39;theme&#39;</span><span class="p">]</span>

	<span class="n">figs</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">:</span>
				<span class="n">fig</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;histogram&#39;</span><span class="p">,</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">asFigure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
				<span class="n">figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">j</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">asFigure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">color</span><span class="p">]))</span>
	<span class="n">layout</span><span class="o">=</span><span class="n">getLayout</span><span class="p">(</span><span class="n">theme</span><span class="p">)</span>
	<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;xaxis1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="n">layout</span><span class="p">[</span><span class="s1">&#39;yaxis1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="n">sm</span><span class="o">=</span><span class="n">subplots</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)),</span><span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">shared_yaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
					  <span class="n">horizontal_spacing</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span><span class="n">vertical_spacing</span><span class="o">=.</span><span class="mi">07</span><span class="p">,</span><span class="n">base_layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
	<span class="n">sm</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bargap</span><span class="o">=.</span><span class="mi">02</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">sm</span></div>

<span class="c1">## Trace dictionary</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">trace_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="n">d</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])):</span>
		<span class="n">trace_</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">trace</span><span class="p">]</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">trace_</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="n">trace_</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
		<span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">trace</span>
	<span class="k">return</span> <span class="n">d</span>


<span class="c1">## Axis Definition</span>

<div class="viewcode-block" id="get_ref"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_ref">[docs]</a><span class="k">def</span> <span class="nf">get_ref</span><span class="p">(</span><span class="n">figure</span><span class="p">):</span>
	<span class="n">d</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
		<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;xaxis&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;xaxis&#39;</span> <span class="ow">in</span> <span class="n">trace</span> <span class="k">else</span> <span class="s1">&#39;x1&#39;</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;yaxis&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;yaxis&#39;</span> <span class="ow">in</span> <span class="n">trace</span> <span class="k">else</span> <span class="s1">&#39;y1&#39;</span>
		<span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="get_def"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_def">[docs]</a><span class="k">def</span> <span class="nf">get_def</span><span class="p">(</span><span class="n">figure</span><span class="p">):</span>
	<span class="n">d</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">items</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;scene&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="s1">&#39;scene&#39;</span> <span class="ow">in</span> <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
	<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
		<span class="k">if</span> <span class="s1">&#39;axis&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
			<span class="n">d</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span> <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;s&#39;</span> <span class="k">else</span> <span class="n">k</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span><span class="o">=</span><span class="n">v</span>
	<span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="get_len"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_len">[docs]</a><span class="k">def</span> <span class="nf">get_len</span><span class="p">(</span><span class="n">figure</span><span class="p">):</span>
	<span class="n">d</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;scene&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="s1">&#39;scene&#39;</span> <span class="ow">in</span> <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
	<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
		<span class="k">if</span> <span class="s1">&#39;axis&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
			<span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="mi">1</span> <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="mi">1</span>
	<span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="get_which"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_which">[docs]</a><span class="k">def</span> <span class="nf">get_which</span><span class="p">(</span><span class="n">figure</span><span class="p">):</span>
	<span class="n">d</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;scene&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="s1">&#39;scene&#39;</span> <span class="ow">in</span> <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
	<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
		<span class="k">if</span> <span class="s1">&#39;axis&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
				<span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;1&#39;</span> <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;s&#39;</span> <span class="k">else</span> <span class="n">k</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
	<span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="get_ref_axis"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_ref_axis">[docs]</a><span class="k">def</span> <span class="nf">get_ref_axis</span><span class="p">(</span><span class="n">figure</span><span class="p">):</span>
	<span class="n">d</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">get_ref</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
				<span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
			<span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="get_dom"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_dom">[docs]</a><span class="k">def</span> <span class="nf">get_dom</span><span class="p">(</span><span class="n">figure</span><span class="p">):</span>
	<span class="n">d</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">which</span><span class="o">=</span><span class="n">get_which</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
	<span class="n">axis_def</span><span class="o">=</span><span class="n">get_def</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
		<span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
		<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">which</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
			<span class="n">item</span><span class="o">=</span><span class="n">axis_def</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
			<span class="n">domain</span><span class="o">=</span><span class="s1">&#39;[0.0, 1.0]&#39;</span> <span class="k">if</span> <span class="s1">&#39;domain&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">domain</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
				<span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">domain</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
			<span class="n">s</span><span class="o">=</span><span class="s1">&#39;left&#39;</span> <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s1">&#39;y&#39;</span> <span class="k">else</span> <span class="s1">&#39;bottom&#39;</span>
			<span class="n">side</span><span class="o">=</span><span class="n">s</span> <span class="k">if</span> <span class="s1">&#39;side&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="k">else</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;side&#39;</span><span class="p">]</span>
			<span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">domain</span><span class="p">][</span><span class="n">side</span><span class="p">]</span><span class="o">=</span><span class="n">y</span>
	<span class="k">return</span> <span class="n">d</span></div>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">axis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span><span class="n">get_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
			<span class="s1">&#39;ref_axis&#39;</span><span class="p">:</span><span class="n">get_ref_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
			<span class="s1">&#39;def&#39;</span><span class="p">:</span><span class="n">get_def</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
			<span class="s1">&#39;len&#39;</span><span class="p">:</span><span class="n">get_len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
			<span class="s1">&#39;which&#39;</span><span class="p">:</span><span class="n">get_which</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
			<span class="s1">&#39;dom&#39;</span><span class="p">:</span><span class="n">get_dom</span><span class="p">(</span><span class="bp">self</span><span class="p">)}</span>

<span class="c1">### Set Axis</span>


<span class="k">def</span> <span class="nf">_set_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">traces</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Sets the axis in which each trace should appear</span>
<span class="sd">	If the axis doesn&#39;t exist then a new axis is created</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		traces : list(str)</span>
<span class="sd">			List of trace names</span>
<span class="sd">		on : string</span>
<span class="sd">			The axis in which the traces should be placed.</span>
<span class="sd">			If this is not indicated then a new axis will be</span>
<span class="sd">			created</span>
<span class="sd">		side : string</span>
<span class="sd">			Side where the axis will be placed</span>
<span class="sd">				&#39;left&#39;</span>
<span class="sd">				&#39;right&#39;</span>
<span class="sd">		title : string</span>
<span class="sd">			Sets the title of the axis</span>
<span class="sd">			Applies only to new axis</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">fig</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
	<span class="n">fig_cpy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
	<span class="n">fig</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig_cpy</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
	<span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig_cpy</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
		<span class="n">traces</span><span class="o">=</span><span class="p">[</span><span class="n">traces</span><span class="p">]</span>

	<span class="k">def</span> <span class="nf">update_data</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
		<span class="n">anchor</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">][</span><span class="s1">&#39;anchor&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;anchor&#39;</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;x1&#39;</span>
		<span class="n">idx</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">trace_dict</span><span class="p">[</span><span class="n">trace</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">trace</span>
		<span class="n">fig</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;xaxis&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">anchor</span>
		<span class="n">fig</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;yaxis&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">y</span>

	<span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">traces</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">on</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">on</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">]:</span>
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;on&quot; axis does not exists: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">on</span><span class="p">))</span>
			<span class="n">update_data</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">on</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">curr_x</span><span class="p">,</span><span class="n">curr_y</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">][</span><span class="n">trace</span><span class="p">]</span>
			<span class="n">domain</span><span class="o">=</span><span class="s1">&#39;[0.0, 1.0]&#39;</span> <span class="k">if</span> <span class="s1">&#39;domain&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">][</span><span class="n">curr_y</span><span class="p">]</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">][</span><span class="n">curr_y</span><span class="p">][</span><span class="s1">&#39;domain&#39;</span><span class="p">])</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">new_axis</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;dom&#39;</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">domain</span><span class="p">][</span><span class="n">side</span><span class="p">]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="n">axis</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">YAxis</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">][</span><span class="n">curr_y</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
				<span class="c1">### check overlaying values</span>
				<span class="n">axis</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">overlaying</span><span class="o">=</span><span class="n">curr_y</span><span class="p">,</span><span class="n">side</span><span class="o">=</span><span class="n">side</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="n">curr_x</span><span class="p">)</span>
				<span class="n">axis_idx</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;len&#39;</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;yaxis</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">axis_idx</span><span class="p">)]</span><span class="o">=</span><span class="n">axis</span>
				<span class="n">new_axis</span><span class="o">=</span><span class="s1">&#39;y</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">axis_idx</span><span class="p">)</span>
			<span class="n">update_data</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">new_axis</span><span class="p">)</span>


	<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
		<span class="nb">id</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">axis</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
		<span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s1">&#39;ref_axis&#39;</span><span class="p">]:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">del</span> <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="nb">id</span><span class="p">]</span>
			<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
				<span class="k">pass</span>

	<span class="k">return</span> <span class="n">fig</span>

<span class="c1">### Shapes</span>

<span class="c1"># def _get_shapes(d):</span>

<span class="c1"># 	def get_shapes(xline):</span>
<span class="c1"># 		orientation=xline[0]</span>
<span class="c1"># 		xline=d[xline]</span>
<span class="c1"># 		if type(xline) in (list,tuple):</span>
<span class="c1"># 			for x_i in xline:</span>
<span class="c1"># 				if isinstance(x_i,dict):</span>
<span class="c1"># 					x_i[&#39;kind&#39;]=&#39;line&#39;</span>
<span class="c1"># 					return get_shape(**x_i)</span>
<span class="c1"># 				else:</span>
<span class="c1"># 					if orientation==&#39;h&#39;:</span>
<span class="c1"># 						return get_shape(kind=&#39;line&#39;,y=x_i)</span>
<span class="c1"># 					else:</span>
<span class="c1"># 						return get_shape(kind=&#39;line&#39;,x=x_i)</span>
<span class="c1"># 		elif isinstance(xline,dict):</span>
<span class="c1"># 			return get_shape(**xline)</span>
<span class="c1"># 		else:</span>
<span class="c1"># 			if orientation==&#39;h&#39;:</span>
<span class="c1"># 				return get_shape(kind=&#39;line&#39;,y=xline)</span>
<span class="c1"># 			else:</span>
<span class="c1"># 				return get_shape(kind=&#39;line&#39;,x=xline)</span>

<span class="c1"># 	def get_span(xspan):</span>
<span class="c1"># 		orientation=xspan[0]</span>
<span class="c1"># 		xspan=d[xspan]</span>
<span class="c1"># 		if isinstance(xspan,list):</span>
<span class="c1"># 			for x_i in xspan:</span>
<span class="c1"># 				if isinstance(x_i,dict):</span>
<span class="c1"># 					x_i[&#39;kind&#39;]=&#39;rect&#39;</span>
<span class="c1"># 					return get_shape(**x_i)</span>
<span class="c1"># 				else:</span>
<span class="c1"># 					v0,v1=x_i</span>
<span class="c1"># 					if orientation==&#39;h&#39;:</span>
<span class="c1"># 						get_shape(kind=&#39;rect&#39;,y0=v0,y1=v1,fill=True,opacity=.5)</span>
<span class="c1"># 					else:</span>
<span class="c1"># 						get_shape(kind=&#39;rect&#39;,x0=v0,x1=v1,fill=True,opacity=.5)</span>
<span class="c1"># 		elif isinstance(xspan,dict):</span>
<span class="c1"># 			xspan[&#39;kind&#39;]=&#39;rect&#39;</span>
<span class="c1"># 			return get_shape(**xspan)</span>
<span class="c1"># 		elif isinstance(xspan,tuple):</span>
<span class="c1"># 			v0,v1=xspan</span>
<span class="c1"># 			if orientation==&#39;h&#39;:</span>
<span class="c1"># 				return get_shape(kind=&#39;rect&#39;,y0=v0,y1=v1,fill=True,opacity=.5)</span>
<span class="c1"># 			else:</span>
<span class="c1"># 				return get_shape(kind=&#39;rect&#39;,x0=v0,x1=v1,fill=True,opacity=.5)</span>
<span class="c1"># 		else:</span>
<span class="c1"># 			raise Exception(&#39;Invalid value for {0}span: {1}&#39;.format(orientation,xspan))</span>

<span class="c1"># 	if &#39;hline&#39; in d:</span>
<span class="c1"># 		return get_shapes(&#39;hline&#39;)</span>
<span class="c1"># 	if &#39;vline&#39; in d:</span>
<span class="c1"># 		return get_shapes(&#39;vline&#39;)</span>
<span class="c1"># 	if &#39;hspan&#39; in d:</span>
<span class="c1"># 		get_span(&#39;hspan&#39;)</span>
<span class="c1"># 	if &#39;vspan&#39; in d:</span>
<span class="c1"># 		get_span(&#39;vspan&#39;)</span>
<span class="c1"># 	if &#39;shapes&#39; in d:</span>
<span class="c1"># 		shapes_=kwargs[&#39;shapes&#39;]</span>
<span class="c1"># 		if isinstance(shapes_,list):</span>
<span class="c1"># 			for i in shapes_:</span>
<span class="c1"># 				shp=i if &#39;type&#39; in i else get_shape(**i)</span>
<span class="c1"># 				shapes.append(shp)</span>
<span class="c1"># 		elif isinstance(shapes_,dict):</span>
<span class="c1"># 				shp=shapes_ if &#39;type&#39; in shapes_ else get_shape(**shapes_)</span>
<span class="c1"># 				shapes.append(shp)</span>
<span class="c1"># 		else:</span>
<span class="c1"># 			raise Exception(&quot;Shapes need to be either a dict or list of dicts&quot;)</span>

<div class="viewcode-block" id="get_shape"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_shape">[docs]</a><span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">x1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">span</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">dash</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
				<span class="n">fillcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">xref</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">yref</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Returns a plotly shape</span>

<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		kind : string</span>
<span class="sd">			Shape kind</span>
<span class="sd">				line</span>
<span class="sd">				rect</span>
<span class="sd">				circle</span>
<span class="sd">		x : float</span>
<span class="sd">			x values for the shape.</span>
<span class="sd">			This assumes x0=x1</span>
<span class="sd">		x0 : float</span>
<span class="sd">			x0 value for the shape</span>
<span class="sd">		x1 : float</span>
<span class="sd">			x1 value for the shape</span>
<span class="sd">		y : float</span>
<span class="sd">			y values for the shape.</span>
<span class="sd">			This assumes y0=y1</span>
<span class="sd">		y0 : float</span>
<span class="sd">			y0 value for the shape</span>
<span class="sd">		y1 : float</span>
<span class="sd">			y1 value for the shape</span>
<span class="sd">		color : string</span>
<span class="sd">			color for shape line</span>
<span class="sd">		dash : string</span>
<span class="sd">			line style</span>
<span class="sd">				solid</span>
<span class="sd">				dash</span>
<span class="sd">				dashdot</span>
<span class="sd">				dot</span>
<span class="sd">		width : int</span>
<span class="sd">			line width</span>
<span class="sd">		fillcolor : string</span>
<span class="sd">			shape fill color</span>
<span class="sd">		fill : bool</span>
<span class="sd">			If True then fill shape</span>
<span class="sd">			If not fillcolor then the</span>
<span class="sd">			line color will be used</span>
<span class="sd">		opacity : float [0,1]</span>
<span class="sd">			opacity of the fill</span>
<span class="sd">		xref : string</span>
<span class="sd">			Sets the x coordinate system</span>
<span class="sd">			which this object refers to</span>
<span class="sd">				&#39;x&#39;</span>
<span class="sd">				&#39;paper&#39;</span>
<span class="sd">				&#39;x2&#39; etc</span>
<span class="sd">		yref : string</span>
<span class="sd">			Sets the y coordinate system</span>
<span class="sd">			which this object refers to</span>
<span class="sd">				&#39;y&#39;</span>
<span class="sd">				&#39;paper&#39;</span>
<span class="sd">				&#39;y2&#39; etc</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">x1</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">x0</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>
				<span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
				<span class="n">x0</span><span class="o">=</span><span class="mi">0</span>
				<span class="n">x1</span><span class="o">=</span><span class="mi">1</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">x0</span><span class="o">=</span><span class="n">x1</span><span class="o">=</span><span class="n">x</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">x1</span><span class="o">=</span><span class="n">x0</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">y1</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">y0</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">y</span><span class="p">:</span>
				<span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
				<span class="n">y0</span><span class="o">=</span><span class="mi">0</span>
				<span class="n">y1</span><span class="o">=</span><span class="mi">1</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">y0</span><span class="o">=</span><span class="n">y1</span><span class="o">=</span><span class="n">y</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">y1</span><span class="o">=</span><span class="n">y0</span>

	<span class="n">shape</span> <span class="o">=</span> <span class="p">{</span>	<span class="s1">&#39;x0&#39;</span><span class="p">:</span><span class="n">x0</span><span class="p">,</span>
				<span class="s1">&#39;y0&#39;</span><span class="p">:</span><span class="n">y0</span><span class="p">,</span>
				<span class="s1">&#39;x1&#39;</span><span class="p">:</span><span class="n">x1</span><span class="p">,</span>
				<span class="s1">&#39;y1&#39;</span><span class="p">:</span><span class="n">y1</span><span class="p">,</span>
				<span class="s1">&#39;line&#39;</span> <span class="p">:</span> <span class="p">{</span>
					<span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="n">normalize</span><span class="p">(</span><span class="n">color</span><span class="p">),</span>
					<span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="n">width</span><span class="p">,</span>
					<span class="s1">&#39;dash&#39;</span><span class="p">:</span><span class="n">dash</span>
					<span class="p">},</span>
				<span class="s1">&#39;xref&#39;</span><span class="p">:</span><span class="n">xref</span><span class="p">,</span>
				<span class="s1">&#39;yref&#39;</span><span class="p">:</span><span class="n">yref</span>
				<span class="p">}</span>

	<span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="s1">&#39;line&#39;</span><span class="p">:</span>
		<span class="n">shape</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;line&#39;</span>

	<span class="k">elif</span> <span class="n">kind</span><span class="o">==</span><span class="s1">&#39;circle&#39;</span><span class="p">:</span>
		<span class="n">shape</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;circle&#39;</span>

	<span class="k">elif</span> <span class="n">kind</span><span class="o">==</span><span class="s1">&#39;rect&#39;</span><span class="p">:</span>
		<span class="n">shape</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;rect&#39;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid or unkown shape type : </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kind</span><span class="p">))</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fill</span> <span class="ow">or</span> <span class="n">fillcolor</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kind</span><span class="o">!=</span><span class="s1">&#39;line&#39;</span><span class="p">:</span>
		<span class="n">fillcolor</span> <span class="o">=</span> <span class="n">color</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">fillcolor</span> <span class="k">else</span> <span class="n">fillcolor</span>
		<span class="n">fillcolor</span><span class="o">=</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">fillcolor</span><span class="p">),</span><span class="n">opacity</span><span class="p">)</span>
		<span class="n">shape</span><span class="p">[</span><span class="s1">&#39;fillcolor&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fillcolor</span>

	<span class="k">return</span> <span class="n">shape</span></div>

<span class="c1">### Advanced Shapes</span>

<div class="viewcode-block" id="get_trendline"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_trendline">[docs]</a><span class="k">def</span> <span class="nf">get_trendline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">date0</span><span class="p">,</span><span class="n">date1</span><span class="p">,</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">])</span>
	<span class="n">d</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x0&#39;</span><span class="p">:</span><span class="n">date0</span><span class="p">,</span>
	   <span class="s1">&#39;x1&#39;</span><span class="p">:</span><span class="n">date1</span><span class="p">,</span>
	   <span class="s1">&#39;y0&#39;</span><span class="p">:</span><span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">date0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
	   <span class="s1">&#39;y1&#39;</span><span class="p">:</span><span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">date1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
	<span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">d</span></div>

<span class="c1">### Range Selector</span>

<div class="viewcode-block" id="get_range_selector"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_range_selector">[docs]</a><span class="k">def</span> <span class="nf">get_range_selector</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1m&#39;</span><span class="p">,</span><span class="s1">&#39;1y&#39;</span><span class="p">],</span><span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;rgba(150, 200, 250, 0.4)&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
						<span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Returns a range selector</span>
<span class="sd">	Reference: https://plot.ly/python/reference/#layout-xaxis-rangeselector</span>
<span class="sd">	</span>
<span class="sd">	Parameters:</span>
<span class="sd">	-----------</span>
<span class="sd">		steps : string or list(string)</span>
<span class="sd">			Steps for the range</span>
<span class="sd">				Examples:</span>
<span class="sd">					[&#39;1y&#39;,&#39;2 months&#39;,&#39;5 weeks&#39;,&#39;ytd&#39;,&#39;2mtd&#39;]</span>
<span class="sd">		bgocolor : string or tuple(color,alpha)</span>
<span class="sd">			Background color</span>
<span class="sd">				Examples:</span>
<span class="sd">					&#39;cyan&#39;</span>
<span class="sd">					&#39;rgba(232,214,10,.5)&#39;</span>
<span class="sd">					(&#39;blue&#39;,.3)</span>
<span class="sd">		font_size : int</span>
<span class="sd">			Font size</span>
<span class="sd">		x : float</span>
<span class="sd">			Position along the x axis</span>
<span class="sd">			Domain (0,1)</span>
<span class="sd">		y : float</span>
<span class="sd">			Position along the y axis</span>
<span class="sd">			Domain (0,1)	</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="kn">import</span> <span class="nn">string</span>

	<span class="k">def</span> <span class="nf">get_step</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>


		<span class="n">term</span><span class="o">=</span><span class="p">[]</span>
		<span class="n">stepmode</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span>
		<span class="n">_s</span><span class="o">=</span><span class="n">s</span>
		<span class="n">_s</span><span class="o">=</span><span class="n">_s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="n">_s</span><span class="o">=</span><span class="n">_s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">_s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="n">s</span><span class="p">,</span><span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="s1">&#39;all&#39;</span><span class="p">}</span>
		<span class="k">if</span> <span class="n">_s</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="o">==</span><span class="s1">&#39;td&#39;</span><span class="p">:</span>
			<span class="n">_s</span><span class="o">=</span><span class="n">_s</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">stepmode</span><span class="o">=</span><span class="s1">&#39;todate&#39;</span>
			<span class="k">if</span> <span class="n">_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">:</span>				
				<span class="n">_s</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="o">+</span><span class="n">_s</span>
		<span class="k">if</span> <span class="n">_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Invalid step format: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
		<span class="k">while</span> <span class="n">_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">:</span>
			<span class="n">term</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">_s</span><span class="o">=</span><span class="n">_s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">term</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
		<span class="n">term</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
		<span class="n">cnt</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">_s</span><span class="p">)</span>
		<span class="n">term</span><span class="o">=</span><span class="n">term</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;s&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">term</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">term</span>		
		<span class="k">if</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;yr&#39;</span><span class="p">]:</span>
					<span class="n">steps</span><span class="o">=</span><span class="s1">&#39;year&#39;</span>
		<span class="k">elif</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="s1">&#39;week&#39;</span><span class="p">,</span><span class="s1">&#39;wk&#39;</span><span class="p">]:</span>
			<span class="n">steps</span><span class="o">=</span><span class="s1">&#39;week&#39;</span>
		<span class="k">elif</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;mth&#39;</span><span class="p">,</span><span class="s1">&#39;mnth&#39;</span><span class="p">,</span><span class="s1">&#39;mo&#39;</span><span class="p">]:</span>
			<span class="n">steps</span><span class="o">=</span><span class="s1">&#39;month&#39;</span>
		<span class="k">elif</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hr&#39;</span><span class="p">,</span><span class="s1">&#39;hour&#39;</span><span class="p">]:</span>
			<span class="n">steps</span><span class="o">=</span><span class="s1">&#39;hour&#39;</span>
		<span class="k">elif</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span><span class="s1">&#39;mn&#39;</span><span class="p">]:</span>
			<span class="n">steps</span><span class="o">=</span><span class="s1">&#39;minute&#39;</span>
		<span class="k">elif</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sec&#39;</span><span class="p">,</span><span class="s1">&#39;sc&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">]:</span>
			<span class="n">steps</span><span class="o">=</span><span class="s1">&#39;second&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Invalid step format: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
		<span class="k">return</span> <span class="p">{</span><span class="s1">&#39;count&#39;</span><span class="p">:</span><span class="n">cnt</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="n">s</span><span class="p">,</span><span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="n">steps</span><span class="p">,</span><span class="s1">&#39;stepmode&#39;</span><span class="p">:</span><span class="n">stepmode</span><span class="p">}</span>

	<span class="n">rangeselector</span><span class="o">=</span><span class="p">{</span>
		<span class="s1">&#39;bgcolor&#39;</span><span class="p">:</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">bgcolor</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
		<span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span>
		<span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">y</span><span class="p">,</span>
		<span class="s1">&#39;visible&#39;</span><span class="p">:</span><span class="n">visible</span>
	<span class="p">}</span>

	<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fontsize&#39;</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>

	<span class="n">rangeselector</span><span class="o">=</span><span class="n">dict_replace_keyword</span><span class="p">(</span><span class="n">rangeselector</span><span class="p">,</span><span class="s1">&#39;font&#39;</span><span class="p">,</span><span class="n">kwargs</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>

	<span class="n">buttons</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
		<span class="n">steps</span><span class="o">=</span><span class="p">[</span><span class="n">steps</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
		<span class="n">buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_step</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
	<span class="n">rangeselector</span><span class="p">[</span><span class="s1">&#39;buttons&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">buttons</span>
	<span class="k">return</span> <span class="n">rangeselector</span></div>

<span class="c1">### Error Bars</span>

<div class="viewcode-block" id="get_error_bar"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.get_error_bar">[docs]</a><span class="k">def</span> <span class="nf">get_error_bar</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">values_minus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">thickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
				 <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
	<span class="n">error</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">ErrorY</span><span class="p">()</span> <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="s1">&#39;y&#39;</span> <span class="k">else</span> <span class="n">go</span><span class="o">.</span><span class="n">ErrorX</span><span class="p">()</span>
	<span class="k">if</span> <span class="nb">type</span><span class="o">==</span><span class="s1">&#39;data&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">values_minus</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">values_minus</span><span class="p">):</span>
					<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Array values need to be of same length&#39;</span><span class="p">)</span>
				<span class="n">error</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">symmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">arrayminus</span><span class="o">=</span><span class="n">values_minus</span><span class="p">)</span>
			<span class="n">error</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">array</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">values_minus</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_minus</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_minus</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
					<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Values should be of same type (int, float)&#39;</span><span class="p">)</span>
				<span class="n">error</span><span class="o">.</span><span class="n">udpate</span><span class="p">(</span><span class="n">symmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">valueminus</span><span class="o">=</span><span class="n">values_minus</span><span class="p">)</span>
			<span class="n">error</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
	<span class="k">elif</span> <span class="nb">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">,</span><span class="s1">&#39;constant&#39;</span><span class="p">]:</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Value should be of type (int, float)&#39;</span><span class="p">)</span>
		<span class="n">error</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
	<span class="k">elif</span> <span class="nb">type</span><span class="o">==</span><span class="s1">&#39;sqrt&#39;</span><span class="p">:</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Invalid type: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>
	<span class="n">error</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span><span class="n">thickness</span><span class="o">=</span><span class="n">thickness</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">color</span><span class="p">:</span>
		<span class="n">error</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">normalize</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">error</span></div>

<div class="viewcode-block" id="set_errors"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.set_errors">[docs]</a><span class="k">def</span> <span class="nf">set_errors</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span><span class="n">trace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">values_minus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">thickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
				 <span class="n">opacity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="n">figure</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">figure</span><span class="p">))</span>
	<span class="k">if</span> <span class="s1">&#39;value&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
		<span class="n">values</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
	<span class="n">data</span><span class="o">=</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="s1">&#39;continuous&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">:</span>
		<span class="n">width</span><span class="o">=</span><span class="n">width</span> <span class="k">if</span> <span class="n">width</span> <span class="k">else</span> <span class="mi">5</span>
		<span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span> <span class="k">if</span> <span class="n">opacity</span> <span class="k">else</span> <span class="mi">1</span>
		<span class="n">error</span><span class="o">=</span><span class="n">get_error_bar</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span><span class="n">values_minus</span><span class="o">=</span><span class="n">values_minus</span><span class="p">,</span>
							<span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">thickness</span><span class="o">=</span><span class="n">thickness</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
			<span class="n">data</span><span class="p">[</span><span class="n">figure</span><span class="o">.</span><span class="n">trace_dict</span><span class="p">[</span><span class="n">trace</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;error_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span><span class="n">error</span><span class="p">})</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
				<span class="n">trace</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;error_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span><span class="n">error</span><span class="p">})</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">width</span><span class="o">=</span><span class="n">width</span> <span class="k">if</span> <span class="n">width</span> <span class="k">else</span> <span class="o">.</span><span class="mi">5</span>
		<span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span> <span class="k">if</span> <span class="n">opacity</span> <span class="k">else</span> <span class="o">.</span><span class="mi">3</span>
		<span class="k">def</span> <span class="nf">get_traces</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">width</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">opacity</span><span class="o">=.</span><span class="mi">3</span><span class="p">):</span>
			<span class="k">if</span> <span class="s1">&#39;percent&#39;</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">:</span>
				<span class="n">y_up</span><span class="o">=</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">value</span><span class="o">/</span><span class="mf">100.00</span><span class="p">)</span>
				<span class="n">y_down</span><span class="o">=</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">value</span><span class="o">/</span><span class="mf">100.00</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">y_up</span><span class="o">=</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">value</span>
				<span class="n">y_down</span><span class="o">=</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">value</span>
			<span class="n">y</span><span class="o">=</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
			<span class="n">upper</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_up</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
							 <span class="n">line</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">),</span><span class="n">x</span><span class="o">=</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
			<span class="k">if</span> <span class="s1">&#39;yaxis&#39;</span> <span class="ow">in</span> <span class="n">trace</span><span class="p">:</span>
				<span class="n">upper</span><span class="p">[</span><span class="s1">&#39;yaxis&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;yaxis&#39;</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">color</span><span class="p">:</span>
				<span class="n">color</span><span class="o">=</span><span class="n">normalize</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]:</span>
					<span class="n">color</span><span class="o">=</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">color</span><span class="o">=</span><span class="s1">&#39;charcoal&#39;</span>
			<span class="n">upper</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">color</span>
			<span class="n">lower</span><span class="o">=</span><span class="n">upper</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="n">name</span><span class="o">=</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">trace</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
			<span class="n">upper</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
			<span class="n">color</span><span class="o">=</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">color</span><span class="p">),</span><span class="n">opacity</span><span class="p">)</span>
			<span class="n">lower</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tonexty&#39;</span><span class="p">,</span><span class="n">fillcolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y_down</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">upper</span><span class="p">,</span><span class="n">lower</span>
		<span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
			<span class="n">traces</span><span class="o">=</span><span class="p">[</span><span class="n">figure</span><span class="o">.</span><span class="n">trace_dict</span><span class="p">[</span><span class="n">trace</span><span class="p">]]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">traces</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])))</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">traces</span><span class="p">:</span>
				<span class="n">trace</span><span class="o">=</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
				<span class="n">upper</span><span class="p">,</span><span class="n">lower</span><span class="o">=</span><span class="n">get_traces</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">)</span>
				<span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">upper</span><span class="p">,</span><span class="n">lower</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">figure</span></div>


<div class="viewcode-block" id="updateColors"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.updateColors">[docs]</a><span class="k">def</span> <span class="nf">updateColors</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
			<span class="n">updateColors</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
				<span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
					<span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">normalize</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
						<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
							<span class="n">updateColors</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
					<span class="k">if</span> <span class="s1">&#39;rgba&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
						<span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">normalize</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">d</span></div>

<span class="k">def</span> <span class="nf">_nodata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="n">d</span><span class="o">=</span><span class="p">[]</span>
	<span class="c1"># _=copy.deepcopy(self)</span>
	<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
		<span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
	<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>	
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;open&#39;</span><span class="p">,</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;index&#39;</span><span class="p">,</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="s1">&#39;marker&#39;</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="n">_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">return</span> <span class="n">d</span>

<span class="k">def</span> <span class="nf">_figure_no_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">return</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">nodata</span><span class="p">(),</span>
	<span class="s1">&#39;layout&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">_update_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
		<span class="n">_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_move_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">update_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">):</span>
		<span class="n">_axis</span><span class="o">=</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">from_axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">axis&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_axis</span><span class="p">),</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_axis</span><span class="p">))</span>
		<span class="n">from_axis</span><span class="o">=</span><span class="n">_axis</span><span class="o">+</span><span class="s1">&#39;axis&#39;</span><span class="o">+</span><span class="n">from_axis</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
		<span class="n">to_axis</span><span class="o">=</span><span class="n">_axis</span><span class="o">+</span><span class="s1">&#39;axis&#39;</span><span class="o">+</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">[</span><span class="n">to_axis</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">from_axis</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">axis&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_axis</span><span class="p">):</span><span class="n">axis</span><span class="p">})</span>
	
	<span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
		<span class="n">update_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xaxis</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
		<span class="n">update_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">yaxis</span><span class="p">)</span>

<span class="c1">### Offline</span>

<div class="viewcode-block" id="go_offline"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.go_offline">[docs]</a><span class="k">def</span> <span class="nf">go_offline</span><span class="p">(</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">offline</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">offline</span><span class="p">:</span>
		<span class="n">py_offline</span><span class="o">.</span><span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span><span class="p">)</span>
		<span class="n">py_offline</span><span class="o">.</span><span class="n">__PLOTLY_OFFLINE_INITIALIZED</span><span class="o">=</span><span class="kc">True</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">py_offline</span><span class="o">.</span><span class="n">__PLOTLY_OFFLINE_INITIALIZED</span><span class="o">=</span><span class="kc">False</span></div>

<div class="viewcode-block" id="is_offline"><a class="viewcode-back" href="../../cufflinks.html#cufflinks.tools.is_offline">[docs]</a><span class="k">def</span> <span class="nf">is_offline</span><span class="p">():</span>
	<span class="k">return</span> <span class="n">py_offline</span><span class="o">.</span><span class="n">__PLOTLY_OFFLINE_INITIALIZED</span></div>



<span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="o">.</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span>
<span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="o">.</span><span class="n">trace_dict</span><span class="o">=</span><span class="n">trace_dict</span>
<span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="o">.</span><span class="n">set_axis</span><span class="o">=</span><span class="n">_set_axis</span>
<span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="o">.</span><span class="n">update_traces</span><span class="o">=</span><span class="n">_update_traces</span>
<span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="o">.</span><span class="n">move_axis</span><span class="o">=</span><span class="n">_move_axis</span>
<span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="o">.</span><span class="n">nodata</span><span class="o">=</span><span class="n">_figure_no_data</span>
<span class="n">go</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">nodata</span><span class="o">=</span><span class="n">_nodata</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Jorge Santos.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>